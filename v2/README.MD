# tetris v2

Backend state controlled tetris.

Node based backend using express and postgress

HTML, CSS, and JS based frontend using no libraries.

# Todo List:
1. Do everything
2. email verification should be added via nodemailer.

# Password Security:

I probably went a bit crazy on this but it was fun and I wanted to learn so I did it.

### Setup stuff:

1. The number of salt rounds for bcrypt is determined based off the speed of the hardware that the server is being ran off of. This is based on settings.bcrypt.minTimePerPHash which is the minimum time in milliseconds for the hash to take, and settings.bcrypt.minSaltRounds which is the lowest salt rounds that the server could use. This is to keep the number of salt rounds high, while still keeping the server fast.
1. The pepper (a secret separate salt applied to all passwords) is in setttings.bcrypt.pepper. This can be any string. It is recommened for this to be a very long and complex string. Personally, I made a script to generate my pepper, which is genPepper.js. This script generates large numbers of SHA512 hashes based off Math.random(), crypto.randomBytes(), and your computers time in nanoseoconds and then combines them to generate a practically completely random SHA512 hash. This generates a pepper which should be basically unbruteforceable. genPepper.js will take up to 15 seconds to run. If you are very paranoid, you could generate a few of these and concatenate these together.


### on every password:

1. The Client hashes the password with SHA512 to keep the raw password off the server.
1. The Server hashes the SHA512 hashed password concatenated with the pepper with SHA512.
1. The Server hashes the SHA512 hashed password pepper combination with bcrypt with a salt.
1. This final bcrypt hash is the final password hash. It can now be stored, or be verified against the original password hash.

Theoretically this approach forces a attacker who has DB access to bruteforce the pepper first by creating a user account with a known password. Bruteforcing this pepper though should be impossible assuming you use a strong pepper, like the ones generated by genPepper.js.

If a RCE vulnerability is found instead of a vulnerability that just allows DB access, security is reduced to bcrypt without the pepper. Uncommon passwords should still be secure without the pepper, but common passwords will likely be bruteforceable with a known pepper.
